<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bus GPS Sender</title>
</head>
<body>
  <h2>Bus GPS Sender</h2>
  <form id="busForm">
    <input id="busName" placeholder="Bus Name" required>
    <input id="busNumber" placeholder="Bus Number" required>
    <button type="submit">Start Sending</button>
  </form>
  <p id="status"></p>

  <script>
    const form = document.getElementById('busForm');
    const status = document.getElementById('status');
    let sending = false;

    form.addEventListener('submit', e => {
      e.preventDefault();
      const name = document.getElementById('busName').value;
      const number = document.getElementById('busNumber').value;
      sending = true;
      status.textContent = "Sending location...";
      sendLocation(name, number);
    });

    function sendLocation(name, number) {
      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(
          pos => {
            const { latitude, longitude } = pos.coords;
            fetch("/update", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                id: name + number,
                name,
                number,
                lat: latitude,
                lon: longitude
              })
            });
          },
          err => (status.textContent = "Error: " + err.message),
          { enableHighAccuracy: true, maximumAge: 1000 }
        );
      } else {
        status.textContent = "Geolocation not supported.";
      }
    }
  </script>
</body>
</html>
