<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bus Tracker Viewer</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  #map { height: 100vh; width: 100%; }
</style>
</head>
<body>
<div id="map"></div>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const SERVER_URL = "https://bus-tracker-mqrq.onrender.com"; // Your Render URL
const socket = io(SERVER_URL);

// Initialize map
const map = L.map('map').setView([0, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// Store markers by bus ID
const markers = {};

// Listen for location updates
socket.on("location", (data) => {
  const { id, lat, lon } = data;
  if (!markers[id]) {
    markers[id] = L.marker([lat, lon]).addTo(map).bindPopup(id);
  } else {
    markers[id].setLatLng([lat, lon]);
  }
  map.setView([lat, lon], 14); // Center map on latest location
});
</script>
</body>
</html>
